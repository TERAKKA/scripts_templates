server {
        listen 80 default_server;
        server_name site.ru www.site.ru;
        return 301 https://site.ru$request_uri;
}

server {
        listen 443 ssl;
        ssl_certificate         /etc/letsencrypt/live/site.ru/fullchain.pem;
        ssl_certificate_key     /etc/letsencrypt/live/site.ru/privkey.pem;
        server_name www.site.ru;
        return 301 https://site.ru$request_uri;
}

server {
        listen 443 ssl;
        server_name site.ru;

        ssl_certificate         /etc/letsencrypt/live/site.ru/fullchain.pem;
        ssl_certificate_key     /etc/letsencrypt/live/site.ru/privkey.pem;

        root /web/sites/site.ru;
        index index.php index.html index.htm;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        rewrite ^/(.*)/$ /$1 permanent;
        rewrite (.*)//+(.*) $1/$2 permanent;

        location / {
             try_files $uri $uri/ /index.php?q=$uri&$args;
        }

	location ~* ^.+\.(jpg|gif|png|css|js|woff2|woff|otf)$ {
                expires 7d;
        }
	location ~ /\.ht {
                deny all;
        }

	location ~* /restricted/ {
                deny all;
                return 404;
        }

	location ~* /administrator/ {
#                allow 192.168.0.0/24;
#                deny all;
#                return 404;
        }

	access_log /var/log/nginx/site/access-site.log;
        error_log /var/log/nginx/site/error-site.log error;


        # redirect server error pages to the static page /40x.html
        #
	error_page 404 /404.html;
        location = /40x.html {
                root /usr/share/nginx/html;
        }

	# redirect server error pages to the static page /50x.html
        #
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
                root /usr/share/nginx/html;
        }
   }

